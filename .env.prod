# üöÄ AeNKI Production Environment Setup
# Environment configuration for autonomous deployment

# ==============================================================================
# üåê PRODUCTION ENVIRONMENT VARIABLES  
# ==============================================================================

# Domain Configuration
DOMAIN=aenki.sistemasorbix.com
BACKEND_DOMAIN=api.sistemasorbix.com
CDN_DOMAIN=cdn.sistemasorbix.com

# Server Configuration
SERVER_HOST=your-server-ip-here
SERVER_PORT=22
SERVER_USER=root
DEPLOY_PATH=/var/www/sistemasorbix.com/aenki
BACKEND_PATH=/opt/aenki-backend

# Application Configuration
BACKEND_PORT=8000
PM2_APP_NAME=aenki-backend
NODE_ENV=production

# SSL Configuration
SSL_EMAIL=admin@sistemasorbix.com
CERTBOT_DOMAINS="aenki.sistemasorbix.com,api.sistemasorbix.com"

# Security Configuration
AENKI_API_KEY=aenki-production-2025
CORS_ORIGINS="https://aenki.sistemasorbix.com,https://sistemasorbix.com"
RATE_LIMIT_WINDOW=900000
RATE_LIMIT_MAX=100

# Database Configuration (if needed)
DB_HOST=localhost
DB_PORT=5432
DB_NAME=aenki_production
DB_USER=aenki_user
DB_PASSWORD_FILE=/etc/secrets/db_password

# Monitoring Configuration
HEALTH_CHECK_INTERVAL=30
LOG_LEVEL=info
LOG_FILE=/var/log/aenki/app.log
METRICS_PORT=9090

# GitHub Integration
GITHUB_REPO=sistemasorbix/aenki-avatar
GITHUB_BRANCH=main
DEPLOY_KEY_PATH=/etc/secrets/deploy_key

# Backup Configuration
BACKUP_PATH=/backup/aenki
BACKUP_RETENTION_DAYS=30
BACKUP_SCHEDULE="0 2 * * *"

# ==============================================================================
# üîß DEVELOPMENT OVERRIDES (when NODE_ENV=development)
# ==============================================================================

# Development Domain (localhost)
DEV_DOMAIN=localhost:3000
DEV_BACKEND_PORT=8000
DEV_CORS_ORIGINS="http://localhost:3000,http://127.0.0.1:3000"

# Development Database
DEV_DB_HOST=localhost
DEV_DB_NAME=aenki_dev
DEV_DB_USER=aenki_dev
DEV_DB_PASSWORD=dev_password

# Development Logging
DEV_LOG_LEVEL=debug
DEV_HEALTH_CHECK_INTERVAL=10

# ==============================================================================
# üöÄ DEPLOYMENT CONFIGURATION
# ==============================================================================

# Deployment Strategy
DEPLOYMENT_STRATEGY=blue-green
ZERO_DOWNTIME=true
PRE_DEPLOY_BACKUP=true
POST_DEPLOY_VERIFICATION=true

# Load Balancer Configuration
LB_HEALTH_CHECK_PATH=/api/health
LB_TIMEOUT=30
LB_RETRIES=3

# Auto-scaling Configuration
MIN_INSTANCES=2
MAX_INSTANCES=10
CPU_THRESHOLD=70
MEMORY_THRESHOLD=80

# ==============================================================================
# üìä MONITORING & ALERTING
# ==============================================================================

# Prometheus Configuration
PROMETHEUS_ENABLED=true
PROMETHEUS_PORT=9090
PROMETHEUS_SCRAPE_INTERVAL=15s

# Grafana Configuration
GRAFANA_ENABLED=true
GRAFANA_PORT=3001
GRAFANA_ADMIN_PASSWORD_FILE=/etc/secrets/grafana_password

# Alert Manager Configuration
ALERTMANAGER_ENABLED=true
ALERTMANAGER_PORT=9093
SLACK_WEBHOOK_URL_FILE=/etc/secrets/slack_webhook
EMAIL_ALERTS_TO=admin@sistemasorbix.com

# Health Check Configuration
HEALTH_CHECK_ENDPOINTS="/api/health,/api/chat,/api/tts"
HEALTH_CHECK_TIMEOUT=10
HEALTH_CHECK_CRITICAL_THRESHOLD=3

# ==============================================================================
# üîê SECURITY CONFIGURATION  
# ==============================================================================

# API Security
API_RATE_LIMIT_ENABLED=true
API_KEY_ROTATION_DAYS=90
JWT_SECRET_FILE=/etc/secrets/jwt_secret
SESSION_SECRET_FILE=/etc/secrets/session_secret

# SSL/TLS Configuration
SSL_PROTOCOLS="TLSv1.2 TLSv1.3"
SSL_CIPHERS="ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256"
HSTS_MAX_AGE=31536000
HSTS_INCLUDE_SUBDOMAINS=true

# Content Security Policy
CSP_DEFAULT_SRC="'self'"
CSP_SCRIPT_SRC="'self' 'unsafe-inline' cdnjs.cloudflare.com"
CSP_STYLE_SRC="'self' 'unsafe-inline' fonts.googleapis.com"
CSP_FONT_SRC="'self' fonts.gstatic.com"
CSP_IMG_SRC="'self' data: https:"

# ==============================================================================
# üìÅ FILE PATHS & DIRECTORIES
# ==============================================================================

# Application Directories
APP_ROOT=/opt/aenki-backend
WEB_ROOT=/var/www/sistemasorbix.com/aenki
UPLOADS_DIR=/var/aenki/uploads
LOGS_DIR=/var/log/aenki
CONFIG_DIR=/etc/aenki
CACHE_DIR=/var/cache/aenki

# System Directories
NGINX_SITES_AVAILABLE=/etc/nginx/sites-available
NGINX_SITES_ENABLED=/etc/nginx/sites-enabled
SYSTEMD_SERVICE_DIR=/etc/systemd/system
CRON_DIR=/etc/cron.d

# ==============================================================================
# üîÑ SERVICE MANAGEMENT
# ==============================================================================

# PM2 Configuration
PM2_INSTANCES=max
PM2_EXEC_MODE=cluster
PM2_MAX_MEMORY_RESTART=500M
PM2_MIN_UPTIME=10s
PM2_MAX_RESTARTS=10

# SystemD Service
SYSTEMD_SERVICE_NAME=aenki-backend
SYSTEMD_USER=aenki
SYSTEMD_GROUP=aenki
SYSTEMD_RESTART_POLICY=always
SYSTEMD_RESTART_DELAY=10s

# ==============================================================================
# üåç NETWORK CONFIGURATION
# ==============================================================================

# Reverse Proxy Configuration
PROXY_TIMEOUT=60s
PROXY_CONNECT_TIMEOUT=5s
PROXY_SEND_TIMEOUT=60s
PROXY_READ_TIMEOUT=60s

# Load Balancer Configuration
LB_METHOD=round_robin
LB_FAIL_TIMEOUT=30s
LB_MAX_FAILS=3
LB_WEIGHT=1

# CDN Configuration
CDN_ENABLED=true
CDN_CACHE_DURATION=86400
CDN_STATIC_EXTENSIONS="js,css,png,jpg,jpeg,gif,svg,ico,woff,woff2"

# ==============================================================================
# üìà PERFORMANCE OPTIMIZATION
# ==============================================================================

# Caching Configuration
REDIS_ENABLED=true
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0
CACHE_TTL=3600

# Compression Configuration
GZIP_ENABLED=true
GZIP_LEVEL=6
GZIP_TYPES="text/plain,text/css,application/json,application/javascript,text/xml,application/xml,application/xml+rss,text/javascript"

# ==============================================================================
# üìã DEPLOYMENT CHECKLIST AUTOMATION
# ==============================================================================

# Pre-deployment Checks
CHECK_DISK_SPACE=true
CHECK_MEMORY_USAGE=true
CHECK_SERVICE_STATUS=true
CHECK_SSL_EXPIRY=true
CHECK_DEPENDENCIES=true

# Post-deployment Verification
VERIFY_HEALTH_ENDPOINTS=true
VERIFY_SSL_CERTIFICATE=true
VERIFY_STATIC_FILES=true
VERIFY_API_RESPONSES=true
VERIFY_PERFORMANCE_METRICS=true

# Rollback Configuration
ENABLE_AUTOMATIC_ROLLBACK=true
ROLLBACK_ON_HEALTH_FAILURE=true
ROLLBACK_TIMEOUT=300
KEEP_PREVIOUS_VERSIONS=3

# ==============================================================================
# üìß NOTIFICATION CONFIGURATION  
# ==============================================================================

# Deployment Notifications
NOTIFY_ON_DEPLOY_START=true
NOTIFY_ON_DEPLOY_SUCCESS=true
NOTIFY_ON_DEPLOY_FAILURE=true
NOTIFY_ON_ROLLBACK=true

# Monitoring Notifications
NOTIFY_ON_SERVICE_DOWN=true
NOTIFY_ON_HIGH_CPU=true
NOTIFY_ON_HIGH_MEMORY=true
NOTIFY_ON_SSL_EXPIRY=true

# Notification Channels
DISCORD_WEBHOOK_FILE=/etc/secrets/discord_webhook
SLACK_WEBHOOK_FILE=/etc/secrets/slack_webhook
EMAIL_SMTP_HOST=smtp.sistemasorbix.com
EMAIL_SMTP_PORT=587
EMAIL_SMTP_USER=noreply@sistemasorbix.com
EMAIL_SMTP_PASSWORD_FILE=/etc/secrets/smtp_password
